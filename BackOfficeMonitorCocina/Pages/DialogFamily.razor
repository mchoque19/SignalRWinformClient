@using BackOfficeMonitorCocina;
@using BackOfficeMonitorCocina.DTO;
@using MudBlazor;
@inject DAL.Interfaces.IGenericRepository<DAL.DAO.Family> _familyService
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar

<EditForm Model="@familyDto" OnValidSubmit="Save">
<DataAnnotationsValidator/>
    <MudDialog>
        <DialogContent>
            <MudTextField @bind-Value="@familyDto.Name" Label="Nombre" For="@(() => familyDto.Name)" />            
            </DialogContent>
        <DialogActions>
            <MudButton OnClick="Cancel">Cancelar</MudButton>
            <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary">Guardar</MudButton>
        </DialogActions>
    </MudDialog>
</EditForm>
   
@code {
    public DAL.DAO.Family family = new DAL.DAO.Family();
    [Parameter] public FamilyDto familyDto { get; set; } = new FamilyDto();
    bool success;
    [CascadingParameter]
    private MudDialogInstance MudDialog { get; set; } = default!;
    void Cancel() => MudDialog.Cancel();

    private async Task Save(EditContext context)
    {       
        if (familyDto.Id != 0)
        {
            family = await _familyService.GetByIdAsync(familyDto.Id);
            family.Name = familyDto.Name;
            await base.OnInitializedAsync();
            var response = _familyService.Update(family);
            if (response)
            {
                Snackbar.Add("Se guardo correctamente", Severity.Success);
                Console.WriteLine("exito");
                MudDialog.Close(DialogResult.Ok(true));
            }
            else
            {
                Snackbar.Add("Error al guardar", Severity.Error);
                Console.WriteLine("bad");
                MudDialog.Close(DialogResult.Cancel());
            }
        }
        else 
        {
            family.Name = familyDto.Name;
            await base.OnInitializedAsync();
            var response = _familyService.Insert(family);
            if (response)
            {
                Snackbar.Add("Se guardo correctamente", Severity.Success);
                Console.WriteLine("exito");
                MudDialog.Close(DialogResult.Ok(true));
            }
            else
            {
                Snackbar.Add("Error al guardar", Severity.Error);
                Console.WriteLine("bad");
                MudDialog.Close(DialogResult.Cancel());
            }
        }
       
    }
}